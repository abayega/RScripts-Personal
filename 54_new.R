rm(list=ls())

setwd('/home/abayega/R/tests/test54_new')
summary_file <- read.table("B002_05_5AB_summary",header=T, sep = '\t')
illumina_exp <- read.table("GCF_000347755.3_Ccap_2.1_embryos_4-8Hrs_rsem.isoforms.results",header=T, sep = '\t')
ont_panhandle <- read.table("Ccap21_B002_05_5A_pass_liqa",header=T, sep = '\t')
ont_regular <- read.table("Ccap21_B002_05_5B_pass_liqa",header=T, sep = '\t')
expressions <- read.table("catLiftOffGenesV1.gtf.isoforms.results_ed_filtered",header=T, sep = '\t')
readstats <- read.table("readstats", header = T, sep = '\t')
readstats_ed <- read.table("readstats_ed", header = T, sep = '\t')
pcr_amp <- read.table("PCR_amplicon_quantification", header = T, sep = '\t')
pcr_amp2 <- read.table("PCR_amplicon_quantification2", header = T, sep = '\t')

library(ggplot2)
library(plyr)

head(pcr_amp2)

my.theme <- theme(axis.text = element_text(colour="black", size=12, face="bold"),
                  text = element_text(size=10),
                  title = element_text(size=14),
                  axis.title.x=  element_text(vjust=-0.3, face="bold"),
                  axis.title.y = element_text(vjust=.1, face="bold"),
                  axis.ticks = element_line(colour="black"),
                  #axis.text.x = rotatedAxisElementText(a,'x'),
                  #axis.text.x = element_text(angle = 45),
                  axis.line = element_line())

#make PCR amplicon concentration plots
ggplot(pcr_amp2, aes(x=Sample, y=concentration, fill=Protocol)) + 
  geom_bar(position=position_dodge(), stat="identity") + #geom_bar(stat="identity") + #
  ggtitle("Total cDNA-PCR yield (ng)") +
  xlab("Sample") +
  ylab("Total cDNA-PCR yield (ng)") +
  my.theme
ggsave(filename = "Total cDNA-PCR yield.png", width = 25, height = 15, units = "cm")

ggplot(pcr_amp2, aes(x=Sample, y=percentage, fill=Protocol)) + 
  geom_bar(position=position_dodge(), stat="identity") + #geom_bar(stat="identity") + #
  ggtitle("Percentage of PCR amplicon yield (%)") +
  xlab("Sample") +
  ylab("Percentage of PCR amplicon yield (%)") +
  my.theme
ggsave(filename = "Percentage of PCR amplicon yield.png", width = 25, height = 15, units = "cm")

#Plot total reads generated
readstats$Total_sequenced_reads2 <- readstats$Total_sequenced_reads/1000000
#colnames(readstats2) <- c('Sample',         'Protocol' 'Total_pass_reads' 'Total_fail_reads' 'Total_pass_unclassified' 'Total_fail_unclassified' 'Total_sequenced_reads')
ggplot(readstats, aes(x=Sample, y=Total_sequenced_reads2, fill=Protocol)) + 
  geom_bar(position=position_dodge(), stat="identity") + #geom_bar(stat="identity") + #
  ggtitle("Total reads from the 2 experiments") +
  xlab("") +
  ylab("Total number of reads (millions)") +
  #ylim(c(0,1)) +
  #scale_fill_manual(values=c("#999999", "#E69F00", "#999999", "#E69F00", "#999999", "#E69F00", "#999999", "#E69F00")) + #999999=blue,#56B4E9=grey,#E69F00=yellow not sure though
  #scale_fill_manual(values=c("#56B4E9", "#999999", "#56B4E9", "#999999", "#56B4E9", "#999999", "#56B4E9", "#999999")) +
  my.theme
ggsave(filename = "Total reads from the 2 experiments2.png", width = 25, height = 15, units = "cm")

readstats$Total_pass_reads2 <- readstats$Total_pass_reads/1000000
ggplot(readstats, aes(x=Sample, y=Total_pass_reads2, fill=Protocol)) + 
  geom_bar(position=position_dodge(), stat="identity") + #geom_bar(stat="identity") + #
  ggtitle("Total pass PASS reads from the 2 experiments") +
  xlab("") +
  ylab("Total number of PASS reads (millions)") +
  #ylim(c(0,1)) +
  #scale_fill_manual(values=c("#999999", "#E69F00", "#999999", "#E69F00", "#999999", "#E69F00", "#999999", "#E69F00")) + #999999=blue,#56B4E9=grey,#E69F00=yellow not sure though
  #scale_fill_manual(values=c("#56B4E9", "#999999", "#56B4E9", "#999999", "#56B4E9", "#999999", "#56B4E9", "#999999")) +
  my.theme
ggsave(filename = "Total pass reads from the 2 experiments2.png", width = 25, height = 15, units = "cm")

#Percentage of PASS and FAIL reads
readstats_ed$Number_of_reads2 <- readstats_ed$Number_of_reads/1000000
readstats_ed_sub <- subset(readstats_ed, Sample %in% c('MCF7', 'HeLa' ,'GM24143' ,'Medfly'))
readstats_ed_sub <- subset(readstats_ed_sub, Category %in% c('Total_pass_reads', 'Total_fail_reads'))
readstats_ed_sub$Sample_Protocol <- paste(readstats_ed_sub$Sample,readstats_ed_sub$Protocol, sep = "-")

ggplot(readstats_ed_sub, aes(x=Sample_Protocol, y=Number_of_reads2, fill=Category)) + 
  geom_bar(position="fill", stat="identity") + #geom_bar(position=position_dodge(), stat="identity") + 
  ggtitle("Proportion of PASS and FAIL reads from the 2 experiments") +
  xlab("Protocol") +
  ylab("Proportion of reads") +
  my.theme
ggsave(filename = "Proportion of PASS and FAIL reads from the 2 experiments2.png", width = 25, height = 15, units = "cm")

#Plot Classified and unclassified reads proportions
pass_class <- read.table("Pass_reads_classification", header = T, sep = '\t')
pass_class$Number_of_reads2 <- pass_class$Number_of_reads/1000000
pass_class$Classification_Category <- paste(pass_class$Classification,pass_class$Category, sep = "-")
pass_class$Protocol_Category <- paste(pass_class$Protocol,pass_class$Category, sep = "-")

ggplot(pass_class, aes(x=Protocol_Category, y=Number_of_reads2, fill=Classification)) + 
  geom_bar(position="fill", stat="identity") + #geom_bar(position=position_dodge(), stat="identity") + 
  ggtitle("Proportion of classified reads from the 2 experiments") +
  xlab("") +
  ylab("Proportion of reads") +
  my.theme
ggsave(filename = "Proportion of classified reads from the 2 experiments.png", width = 25, height = 15, units = "cm")

#Plot read length distributions
GM24143_ONT <- read.table('GM24143_pass.pychop.all.cutadapt.C1readlengths', header = F, sep = '\t')
GM24143_Panh <- read.table('GM24143_pass.porechop.pychop.all.cutadapt.C2readlengths', header = F, sep = '\t')
Medfly_ONT <- read.table('Cc_E_6Hbulk_pass.pychop.all.cutadapt.C1readlengths', header = F, sep = '\t')
Medfly_Panh <- read.table('Cc_E_6Hbulk_pass.porechop.pychop.all.cutadapt.C2readlengths', header = F, sep = '\t')
MCF7_ONT <- read.table('MCF7_pass.pychop.all.cutadapt.C1readlengths', header = F, sep = '\t')
MCF7_Panh <- read.table('MCF7_pass.porechop.pychop.all.cutadapt.C2readlengths', header = F, sep = '\t')
HeLa_ONT <- read.table('HeLa_pass.pychop.all.cutadapt.C1readlengths', header = F, sep = '\t')
HeLa_Panh <- read.table('HeLa_pass.porechop.pychop.all.cutadapt.C2readlengths', header = F, sep = '\t')

Sample <- c(rep("GM24143", (length(GM24143_ONT$V1)+length(GM24143_Panh$V1))), rep("Medfly", (length(Medfly_ONT$V1)+length(Medfly_Panh$V1))),
            rep("MCF7", (length(MCF7_ONT$V1)+length(MCF7_Panh$V1))), rep("HeLa", (length(HeLa_ONT$V1)+length(HeLa_Panh$V1))))
rd_lengths <- c(GM24143_ONT$V1,GM24143_Panh$V1,Medfly_ONT$V1,Medfly_Panh$V1,MCF7_ONT$V1,MCF7_Panh$V1,HeLa_ONT$V1,HeLa_Panh$V1)
protocol <- c(rep("ONT", length(GM24143_ONT$V1)), rep("Panhandle", length(GM24143_Panh$V1)),  rep("ONT", length(Medfly_ONT$V1)), rep("Panhandle", length(Medfly_Panh$V1)),
              rep("ONT", length(MCF7_ONT$V1)), rep("Panhandle", length(MCF7_Panh$V1)),  rep("ONT", length(HeLa_ONT$V1)), rep("Panhandle", length(HeLa_Panh$V1)))
rd_len_df <- as.data.frame(cbind(Sample,protocol,rd_lengths))  

ggplot(rd_len_df, aes(x=Sample, y=rd_lengths, fill=protocol)) +
  geom_boxplot(width=0.5) + theme_minimal() +
  #geom_violin(fill='#A4A4A4', color="darkred")
  #scale_fill_manual(values = c("yellow", "red", "green")) +
  labs(x = "") +
  labs(fill = 'Protocol') +
  labs(y = "Read length (bp") + 
  ggtitle("Read lengths of reads") +
  ylim(0,1500) +
  theme(
    #plot.title = element_text(color="red", size=14, face="bold.italic"),
    #axis.text.x = element_text(size=14,angle=90,hjust=.5,vjust=.5,face="plain"),
    axis.text.x = element_text(size=14),
    axis.text.y = element_text(size=14),
    axis.title.x = element_text(size=14, face="bold"),
    axis.title.y = element_text(size=14, face="bold")
  )
write.table(rd_len_df, file="rd_len_df.txt", quote = FALSE, sep='\t')
#This was taking up so much memory and failing, I did it on the cluster. Check it out at /home/banthony/scratch/analysis/nanopore/capitata/rna_seq/B002_05_6C/R

#Plot alignment stats
align_stats <- read.table('align_stats', header = T, sep = '\t')
ggplot(align_stats, aes(x=Sample, y=mapping_rate, fill=Protocol)) + 
  geom_bar(position=position_dodge(), stat="identity") + #geom_bar(position=position_dodge(), stat="identity") + 
  ggtitle("Percentage of aligned reads from the 2 experiments") +
  xlab("") +
  ylab("Percentage of reads aligning (%)") +
  my.theme
ggsave(filename = "Percentage of aligned reads from the 2 experiments.png", width = 25, height = 15, units = "cm")

#Now, let us plot genebody coverage
HeLa_ONT <- c(0.0,0.226249446735,0.299499220765,0.31953039016,0.346594175495,0.375548813681,0.381240026387,0.381519838692,0.378251970133,0.378023032792,0.38518792364,0.375530159527,0.37315429868,0.369630359466,0.357813801021,0.349475394323,0.339887159329,0.33243058535,0.310644229677,0.316593208871,0.302755218499,0.329245812566,0.321234701474,0.307328877817,0.312380761802,0.293811399723,0.29156442212,0.285986830167,0.293039796093,0.290104310636,0.291571205448,0.267068126665,0.265123007185,0.248127377345,0.255719617895,0.258878953197,0.251268058493,0.250058930167,0.257832624758,0.254162843978,0.25773935399,0.261217505736,0.27060054504,0.243472318084,0.258904390679,0.241617077708,0.255136251634,0.238198280087,0.25172254151,0.262075596806,0.262775975485,0.24582443728,0.254091619028,0.253616786025,0.264816061565,0.263939316342,0.267275018188,0.270307166078,0.272630456128,0.266571247844,0.288730686592,0.302712822696,0.31238754513,0.324275328525,0.325762573324,0.333037693261,0.339712488617,0.362046598076,0.386476756077,0.409884327289,0.429588201078,0.447609809372,0.440553451782,0.457950993842,0.480390244895,0.503187316532,0.515666945348,0.513285997005,0.539841032694,0.563280824717,0.584505859948,0.592881574953,0.632816726332,0.649412139784,0.653967144948,0.696586798625,0.738545077762,0.752342368162,0.777396592395,0.820923516274,0.846435615189,0.872654876111,0.903807312767,0.926417842868,0.977051999301,0.992677396762,1.0,0.965264270004,0.838424504096,0.31085960036)
GM24143_ONT <- c(0.0,0.279444528974,0.383327718124,0.395347889406,0.411712602704,0.450416793462,0.461738686258,0.472030822067,0.467610203017,0.484472134069,0.497831804547,0.489001434595,0.485610572534,0.491278311525,0.475492327088,0.476225927053,0.474071316785,0.455527539886,0.439353019171,0.445727187758,0.425593944268,0.460336695214,0.459133047863,0.443545407121,0.455397122115,0.415771855845,0.414581793679,0.40795494066,0.422425879233,0.42227915924,0.422148741469,0.38651208538,0.390516997783,0.377230687302,0.387533691258,0.403575077164,0.386593596487,0.391508716254,0.392024953267,0.391155501456,0.408998282833,0.416154958049,0.433505955745,0.398814828501,0.41212015824,0.394785462766,0.415573512151,0.396002695301,0.417249923923,0.433275007608,0.433832000174,0.406262226666,0.413712341868,0.403292505325,0.416603269139,0.40856083989,0.403588662348,0.403512585315,0.407965808808,0.390188236317,0.413122744859,0.433261422423,0.4357773986,0.452769747424,0.452916467417,0.468865474069,0.478201212885,0.499081641525,0.515253445203,0.542804199452,0.540717515107,0.564070447333,0.552702364909,0.571756944746,0.598821349389,0.619090444725,0.620813046124,0.605410163892,0.629002195366,0.641620114768,0.65675944442,0.64843716037,0.690863691692,0.712100052167,0.728529974351,0.768584532452,0.823762117985,0.836907142547,0.848959918272,0.885248663218,0.90731371995,0.92208624962,0.94540929444,0.951221036387,0.990224101204,1.0,0.983494000783,0.913720492979,0.755067273834,0.168010694257)
MCF7_ONT <- c(0.0,0.257599582139,0.347035795705,0.365200252458,0.398112278487,0.436895039528,0.451699738293,0.467730000598,0.46361259678,0.485211623947,0.50141871562,0.497426452585,0.492313363403,0.498554079862,0.470819073632,0.476430005495,0.471121043783,0.470575593195,0.4571134374,0.466605093774,0.45310621188,0.486637140696,0.482435402872,0.483865000299,0.496369557056,0.469257534291,0.468673997377,0.470559270484,0.484103039833,0.483018939786,0.482348348414,0.458868128819,0.46028004331,0.447778207005,0.450751660836,0.464319914251,0.450286463576,0.453285761699,0.450467373621,0.450957054948,0.458756590295,0.465370008651,0.479709510155,0.454809214714,0.470167525423,0.453255836729,0.480068609795,0.453563247784,0.472690744479,0.485438781673,0.479364012775,0.454515405919,0.458964704858,0.453210949274,0.466173902162,0.470729298722,0.465285674645,0.466965553639,0.472641776346,0.452101004935,0.47371363436,0.488741410173,0.49280304473,0.504400330807,0.509302584973,0.522791945286,0.525059441872,0.5506153662,0.568585310648,0.593565859418,0.599131903827,0.616383648996,0.606598183826,0.628153683764,0.642642810118,0.664176546441,0.665736725555,0.653389955004,0.668887008754,0.683401979401,0.696824688644,0.688058032678,0.725092903429,0.74161012661,0.75000680113,0.785119672675,0.826318194926,0.835822093333,0.845923130914,0.884507298972,0.902572459234,0.916071341128,0.936621634121,0.948020327216,0.990591317406,1.0,0.988095302868,0.929423318625,0.775853813801,0.214915693198)
Medfly_ONT <- c(0.0,0.102484705332,0.179333628237,0.241079849432,0.274799061871,0.301012828324,0.325152529358,0.345202523933,0.381431898041,0.425965880163,0.487605685527,0.515474113827,0.534568452505,0.553043075459,0.574587064843,0.584677789555,0.604992780416,0.617478904626,0.631949371103,0.632423025882,0.637505946767,0.644573209919,0.647619623914,0.644917496432,0.646574244865,0.646695266791,0.651784447431,0.654799562652,0.650363483094,0.654463622478,0.662916378022,0.652790181366,0.663813609542,0.671957550516,0.66924081694,0.673219934398,0.681528715582,0.686709705958,0.68521988432,0.699239648452,0.70452288149,0.708339245324,0.706968359026,0.704744059493,0.712070059176,0.717491006819,0.715053875623,0.722315191173,0.726782569504,0.728483136221,0.731487818517,0.730617712602,0.720842062214,0.72646332201,0.736526921119,0.738722008463,0.743892565915,0.740750169013,0.748003138224,0.744898299851,0.759068298098,0.769766219025,0.789442714897,0.793077545842,0.799216278701,0.801536561141,0.809021141278,0.813544857403,0.816651782361,0.836071628287,0.840413811523,0.846293807851,0.851053308072,0.845884837205,0.847779456319,0.855948436313,0.879839833741,0.896401058316,0.899699949087,0.912117215995,0.916263260247,0.929640356222,0.929275203859,0.93592723661,0.946418585629,0.946948578201,0.96107684475,0.968444576131,0.970823282949,0.976169113535,0.982983899911,0.983758022919,0.989064208391,0.993640089139,0.997385509085,1.0,0.979305250682,0.938237086126,0.831138941517,0.56406859022)
HeLa_PanH <- c(0.0760954445065,0.595170625984,0.758028927142,0.827338738045,0.894086141855,0.946928051446,0.974235636233,0.978676522925,0.982030140262,0.991289466382,1.0,0.997114713106,0.977241616215,0.97562721722,0.948766300014,0.929380101733,0.926442205032,0.924018027627,0.899901072931,0.911031657694,0.885160011182,0.911904361559,0.904475031489,0.89050558025,0.895340524716,0.866908534239,0.865997662474,0.882840021828,0.885216747249,0.867022006373,0.853265057494,0.825394238298,0.813898479577,0.790434505432,0.779975469388,0.798757170665,0.788942862654,0.78655685315,0.794142981078,0.789599969466,0.792615233531,0.790758416796,0.810039395462,0.776165900386,0.799711368154,0.771454743703,0.793905721162,0.755023978725,0.773733470463,0.792891692911,0.789298752529,0.751584741505,0.754885749035,0.739621683906,0.740093109044,0.736286634736,0.728793347645,0.731185546539,0.723470473003,0.687940284774,0.713945003151,0.715306668757,0.725497497939,0.722782419247,0.710914265614,0.725625411981,0.71195717768,0.734142011407,0.748938777658,0.766728113546,0.772632790765,0.786427907543,0.763291971021,0.779875407597,0.788088726956,0.813516800581,0.811331946222,0.796592947604,0.822428489345,0.841927128196,0.861647553489,0.845534510486,0.870525200614,0.880555105679,0.879500846399,0.903500202702,0.916897135448,0.915181643097,0.928761162821,0.953655917417,0.953165924112,0.945645816334,0.961004785429,0.960173344158,0.993593982263,0.983741506353,0.95945537502,0.881283390465,0.683181676107,0.0)
MCF7_PanH <- c(0.0266503433207,0.497003108964,0.666363812134,0.729761360895,0.79731332098,0.867274428982,0.899981862949,0.937286868262,0.941372837884,0.974157268765,0.989393247199,1.0,0.979736123017,0.991728820287,0.961777875878,0.96340678839,0.962224457984,0.960658854046,0.947731072019,0.965018590477,0.94236096496,0.969433935791,0.965753483255,0.978161108345,0.986090079546,0.958116244809,0.951895749599,0.983510682894,0.98484700713,0.97228538821,0.954752335145,0.940862091681,0.936018985728,0.917787827301,0.900111046662,0.92983955554,0.91782718128,0.92357885083,0.913446912338,0.903352616783,0.908228232544,0.912763350837,0.927990774059,0.893742546271,0.91388322819,0.892304415003,0.924343686852,0.886689628858,0.906157015531,0.919314932782,0.91324073171,0.876032400302,0.874176774651,0.856391342809,0.85967312243,0.868055519909,0.855753123936,0.850815910643,0.845177169901,0.801279517623,0.806913125236,0.806047337703,0.805584500692,0.804426124882,0.795856368244,0.816694300004,0.807403338928,0.828218171614,0.835731359475,0.852665547645,0.856315201415,0.872157744435,0.849514662779,0.873743880884,0.873775535171,0.891140050544,0.881384541415,0.85228740724,0.861929132039,0.867221386663,0.876961496409,0.854650357009,0.863244923764,0.865815765204,0.866538680684,0.877893159081,0.883627718205,0.877635647176,0.880806209031,0.891719238449,0.891343664608,0.882853471449,0.886198559644,0.879432241859,0.904791603572,0.891300033023,0.859617513547,0.786753621849,0.617116585307,0.0)
GM24143_PanH <- c(0.111210131881,0.576963775059,0.730681821807,0.777303234328,0.824357478685,0.891303908567,0.920395099961,0.942925751793,0.942454635076,0.974427827152,0.999391695797,1.0,0.979547366372,0.988533678464,0.962466992584,0.962180919454,0.968912677506,0.957891949434,0.942806643277,0.954962092652,0.922682621536,0.943355393223,0.948552565672,0.950348764621,0.955543810133,0.91698561871,0.915368082534,0.946125729673,0.950909212725,0.939989514197,0.919883571426,0.900354028792,0.901963057218,0.881289222062,0.871559545218,0.90098679278,0.88775723983,0.894057229515,0.891027406657,0.881551898877,0.900249808841,0.904804646083,0.928234992593,0.894929274002,0.910990844596,0.886014214325,0.918537219816,0.889755497868,0.909951835494,0.929379285115,0.924774464836,0.886538504486,0.888484652549,0.864125897701,0.870890623288,0.865140447019,0.852382010786,0.847346485608,0.83887170205,0.794488891536,0.801556705756,0.805581935492,0.799923217546,0.796057508144,0.785141000022,0.811081133105,0.809425312048,0.826085615626,0.830459663157,0.85451745631,0.850547526956,0.868385090592,0.848166420119,0.866908995777,0.878843243623,0.898033539682,0.889213128736,0.863453785364,0.875874038491,0.880138548727,0.888694155919,0.864439621022,0.883589505264,0.892241888125,0.898924726609,0.911124841676,0.923428113225,0.916676149264,0.921816957862,0.931236101791,0.931584919586,0.924723418329,0.932116654029,0.921015102322,0.948215446035,0.937008610908,0.901095266606,0.820058937446,0.644817343901,0.0)
Medfly_Panh <- c(0.0,0.135674834857,0.256664971363,0.347867338046,0.42174885914,0.475774510766,0.528241672937,0.576865155963,0.639253313029,0.705328507171,0.775318761655,0.820160032677,0.847608085507,0.877168823469,0.909635370969,0.919408646444,0.94049584155,0.954775055048,0.969087976333,0.970651422816,0.971081692805,0.974764764259,0.984110743961,0.983419734323,0.986697320925,0.984626274824,0.994684083679,0.99560807361,0.990844370155,0.992876751442,1.0,0.995657643885,0.997297428592,0.99858823856,0.995788509412,0.988786212325,0.992499025944,0.990477550118,0.986645767839,0.996866167197,0.98988369822,0.990203922198,0.985365863331,0.979433292785,0.98248285612,0.981372481954,0.97942337873,0.979939900998,0.980756819135,0.97932622099,0.979426352946,0.975978244598,0.970526505722,0.967415475245,0.971141177135,0.967708931275,0.969133580986,0.957943587044,0.960509344493,0.952684180836,0.95283784869,0.952180546839,0.96045481719,0.951148493708,0.950432698933,0.944668667323,0.943773428151,0.939746338987,0.933884158232,0.936478666441,0.928643588729,0.925663423779,0.92057652213,0.913831990475,0.904919254979,0.901949004084,0.898322442744,0.892722984448,0.890510167359,0.885947719222,0.877246153099,0.873080267164,0.868207509104,0.866775919553,0.859791467766,0.849776289348,0.846966646145,0.840731696919,0.829649766177,0.82904699163,0.825321289739,0.814714242234,0.801958818998,0.796473372335,0.784364345489,0.768800270455,0.744385918473,0.699266062504,0.587412719138,0.338582825486)

data_matrix <- matrix(c(HeLa_ONT,GM24143_ONT,MCF7_ONT,Medfly_ONT,HeLa_PanH,MCF7_PanH,GM24143_PanH,Medfly_Panh), byrow=T, ncol=100)
rowLabel <- c("HeLa_ONT","GM24143_ONT","MCF7_ONT","Medfly_ONT","HeLa_PanH","MCF7_PanH","GM24143_PanH","Medfly_Panh")

pdf("GeneBodyCoverage1.heatMap.pdf")
png("GeneBodyCoverage1.heatMap.png")
rc <- cm.colors(ncol(data_matrix))
heatmap(data_matrix, scale=c("none"),keep.dendro=F, labRow = rowLabel ,Colv = NA,Rowv = NA,labCol=NA,col=cm.colors(256),margins = c(6, 8),ColSideColors = rc,cexRow=1,cexCol=1,xlab="Gene body percentile (5'->3')", add.expr=x_axis_expr <- axis(side=1,at=c(1,10,20,30,40,50,60,70,80,90,100),labels=c("1","10","20","30","40","50","60","70","80","90","100"),cex.lab=1.5,font=2))
dev.off()

library(RColorBrewer)
cols1 <- brewer.pal(9, "Set1")
cols2 <- brewer.pal(4, "BrBG")
cols3 <- brewer.pal(3, "Pastel1")
icolor = colorRampPalette(c(cols1,cols2,cols3))(8)

pdf("GeneBody_coverage.geneBodyCoverage.curves.pdf")
png("GeneBody_coverage.geneBodyCoverage.curves2.png")
x=1:100
#icolor = colorRampPalette(c("#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#E495A5","#ABB065"))(8)
#icolor = colorRampPalette(c("#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f"))(8)
#icolor = colorRampPalette(c("red","yellow","#fdc086","#ffff99","#386cb0","#f0027f","#E495A5","#ABB065"))(8)
icolor = colorRampPalette(brewer.pal(8,"Dark2"))(8)
plot(x,HeLa_ONT,type='l',xlab="Gene body percentile (5'->3')", ylab="Coverage",lwd=0.8,col=icolor[1], cex.lab=1.5, font=2)
lines(x,GM24143_ONT,type='l',col=icolor[2])
lines(x,MCF7_ONT,type='l',col=icolor[3])
lines(x,Medfly_ONT,type='l',col=icolor[4])
lines(x,HeLa_PanH,type='l',col=icolor[5])
lines(x,MCF7_PanH,type='l',col=icolor[6])
lines(x,GM24143_PanH,type='l',col=icolor[7])
lines(x,Medfly_Panh,type='l',col=icolor[8])
legend(63,0.4,fill=icolor[1:8], legend=c("HeLa_ONT","GM24143_ONT","MCF7_ONT","Medfly_ONT","HeLa_PanH","MCF7_PanH","GM24143_PanH","Medfly_Panh"))
dev.off()

MCF7_cDNA_PCR <- c(0.0,0.0896728589285,0.122236110512,0.125533382182,0.158204387742,0.163376578596,0.180832722727,0.213676134649,0.208008275505,0.226972975303,0.227576397569,0.273091677083,0.249256497565,0.245700616353,0.241390457308,0.274126115254,0.263092108099,0.242575751045,0.254234731262,0.241002542994,0.269018576785,0.276819964657,0.279707771217,0.28285418732,0.306258350933,0.280246541097,0.315719150037,0.300461187018,0.332442567131,0.340222404207,0.320007758286,0.294426964355,0.291237446662,0.304771346063,0.340243955002,0.3352872721,0.337873367527,0.36931597776,0.384810999526,0.36213956295,0.35879918969,0.366320417223,0.375350200422,0.375177794061,0.387763458472,0.375522606784,0.399379337098,0.405154950218,0.393776130339,0.40965906642,0.426425585104,0.422136976854,0.433020128443,0.413689065127,0.436726865221,0.455626912633,0.433925261842,0.476100168096,0.470540062928,0.465497176846,0.5081246498,0.472264126546,0.521399939658,0.519417266497,0.51629240119,0.549545278221,0.52540838757,0.524223093832,0.549286668678,0.56822981768,0.577324253265,0.582237834576,0.580535321753,0.619348303952,0.632257230292,0.655057971639,0.647213482177,0.660531873626,0.665337700961,0.695745873023,0.713546829878,0.695013145985,0.73483901556,0.751433127882,0.790224559286,0.829878022499,0.792746002327,0.844058445757,0.857269083229,0.91498211284,0.929895263135,0.92265419594,0.9323089522,0.988836688074,0.974656264816,1.0,0.997090642645,0.967264342054,0.830589198741,0.512477910435)
MCF7_cDNA_direct <- c(0.0,0.0900990000786,0.151219128772,0.199835470462,0.255754145862,0.296606463813,0.323739338204,0.358298935518,0.388217975691,0.406692444996,0.437176960065,0.447089177909,0.477117344817,0.488999948871,0.512455328628,0.520020940123,0.537703286699,0.546384585505,0.564364550447,0.581336428564,0.591346326283,0.61909046301,0.6051184254,0.632133015568,0.626595787708,0.65171477782,0.664793197207,0.659679503176,0.676443048436,0.674062101506,0.669965651788,0.680927165155,0.693640811262,0.693562972612,0.712168699247,0.723825418593,0.726443697092,0.735643920229,0.743575831252,0.748792547026,0.749400756866,0.771338282956,0.765866683761,0.778629169805,0.796136760981,0.797081508513,0.788023989567,0.802811043626,0.809332701467,0.820937528379,0.800391177371,0.812581320403,0.814210590177,0.80494779087,0.826361813885,0.827820907003,0.847077578424,0.842149323529,0.844675264022,0.857555271165,0.868181009964,0.857334728324,0.850909987233,0.884501180171,0.878469447948,0.887244611009,0.890749639615,0.89069927343,0.891007575532,0.908562480397,0.896325023676,0.919336265256,0.912974100334,0.912227001922,0.921247890916,0.929045492112,0.917479584525,0.928455597248,0.936407349495,0.926982767897,0.936511134361,0.952373430159,0.935074171839,0.946930066552,0.944794845555,0.943933278541,0.963753135486,0.966485119463,0.961504972135,0.973112851543,0.978927093421,0.980698304262,0.967371106446,0.987504607361,0.95985662426,0.972841179393,0.973811873141,1.0,0.959048475927,0.821122967515)
MCF7_RNA_direct <- c(0.0,0.100704433336,0.211171393881,0.276133218845,0.342961409304,0.393491375067,0.406286575295,0.464659378042,0.440861508844,0.491332680675,0.495368952429,0.50817098916,0.549628914582,0.531628400477,0.536517867886,0.551884960786,0.569632524256,0.561621509281,0.590284234476,0.622871112764,0.596582021636,0.642603996893,0.610196235001,0.668718073528,0.661970444427,0.637017206112,0.700915271108,0.680919865239,0.682088907363,0.674036873366,0.701061572286,0.681717001564,0.687633311821,0.693326752059,0.720097133044,0.714500771158,0.673414751534,0.748165082421,0.696456503429,0.742172203323,0.715589142538,0.764590466085,0.769560604238,0.751624353267,0.774452806248,0.781815720677,0.776886601547,0.772411426259,0.799500388313,0.793707135122,0.784548954835,0.76757801818,0.765304197066,0.744839807047,0.80093742138,0.804357040505,0.811275582197,0.8094078494,0.796791765568,0.832977379377,0.869432351429,0.819721398803,0.828022281533,0.869242296628,0.840974721344,0.847939751261,0.850879447829,0.817753853053,0.860971494514,0.863857866355,0.879205817044,0.893613064832,0.855950766235,0.877883637239,0.903180068037,0.891704313013,0.897019010949,0.885514542611,0.929475995668,0.894920204329,0.864575699238,0.920722536398,0.892977269993,0.913687774144,0.944557322716,0.917029457127,0.908090044957,0.927724483434,0.918697564017,0.958823738528,0.950432613951,0.925633880618,0.952145841765,0.970562015292,0.921332352523,0.979736603187,0.996800516293,1.0,0.916344439461,0.785784994695)
MCF7_PanH <- c(0.0266503433207,0.497003108964,0.666363812134,0.729761360895,0.79731332098,0.867274428982,0.899981862949,0.937286868262,0.941372837884,0.974157268765,0.989393247199,1.0,0.979736123017,0.991728820287,0.961777875878,0.96340678839,0.962224457984,0.960658854046,0.947731072019,0.965018590477,0.94236096496,0.969433935791,0.965753483255,0.978161108345,0.986090079546,0.958116244809,0.951895749599,0.983510682894,0.98484700713,0.97228538821,0.954752335145,0.940862091681,0.936018985728,0.917787827301,0.900111046662,0.92983955554,0.91782718128,0.92357885083,0.913446912338,0.903352616783,0.908228232544,0.912763350837,0.927990774059,0.893742546271,0.91388322819,0.892304415003,0.924343686852,0.886689628858,0.906157015531,0.919314932782,0.91324073171,0.876032400302,0.874176774651,0.856391342809,0.85967312243,0.868055519909,0.855753123936,0.850815910643,0.845177169901,0.801279517623,0.806913125236,0.806047337703,0.805584500692,0.804426124882,0.795856368244,0.816694300004,0.807403338928,0.828218171614,0.835731359475,0.852665547645,0.856315201415,0.872157744435,0.849514662779,0.873743880884,0.873775535171,0.891140050544,0.881384541415,0.85228740724,0.861929132039,0.867221386663,0.876961496409,0.854650357009,0.863244923764,0.865815765204,0.866538680684,0.877893159081,0.883627718205,0.877635647176,0.880806209031,0.891719238449,0.891343664608,0.882853471449,0.886198559644,0.879432241859,0.904791603572,0.891300033023,0.859617513547,0.786753621849,0.617116585307,0.0)
data_matrix1 <- matrix(c(MCF7_cDNA_PCR,MCF7_cDNA_direct,MCF7_RNA_direct,MCF7_PanH), byrow=T, ncol=100)
rowLabel <- c("MCF7_cDNA_PCR","MCF7_cDNA_direct","MCF7_RNA_direct","MCF7_PanH")

pdf("MCF7-test_geneBody_coverage.geneBodyCoverage.heatMap.pdf")
png("MCF7-test_geneBody_coverage.geneBodyCoverage.heatMap.png")
rc <- cm.colors(ncol(data_matrix1))
heatmap(data_matrix1, scale=c("none"),keep.dendro=F, labRow = rowLabel ,Colv = NA,Rowv = NA,labCol=NA,col=cm.colors(256),margins = c(6, 8),ColSideColors = rc,cexRow=1,cexCol=1,xlab="Gene body percentile (5'->3')", add.expr=x_axis_expr <- axis(side=1,at=c(1,10,20,30,40,50,60,70,80,90,100),labels=c("1","10","20","30","40","50","60","70","80","90","100"),cex.lab=1.5,font=2))
dev.off()

pdf("MCF7-test_geneBody_coverage.geneBodyCoverage.curves.pdf")
png("MCF7-test_geneBody_coverage.geneBodyCoverage.curves.png")
x=1:100
icolor = colorRampPalette(c("#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f"))(4)
plot(x,MCF7_cDNA_PCR,type='l',xlab="Gene body percentile (5'->3')", ylab="Coverage",lwd=0.8,col=icolor[1], cex.lab=1.5, font=2)
lines(x,MCF7_cDNA_direct,type='l',col=icolor[2])
lines(x,MCF7_RNA_direct,type='l',col=icolor[3])
lines(x,MCF7_PanH,type='l',col=icolor[4])
legend(60,0.25,fill=icolor[1:4], legend=c('MCF7_cDNA_PCR','MCF7_cDNA_direct','MCF7_RNA_direct','MCF7_PanH'))
dev.off()

#Trying to see if 0.6X AMPure rescues ONT protocol
HeLa_ONT_0.6 <- c(0.0,0.239847693347,0.317701157537,0.336781190706,0.36458004199,0.393472755297,0.400477000829,0.401139412875,0.398496180304,0.398165776233,0.405162002249,0.394810410615,0.390224851198,0.385605609812,0.370706952439,0.360536601874,0.352339052318,0.348653282629,0.323897035826,0.33215713761,0.316732399969,0.346046939833,0.33698488642,0.321906591882,0.325253937983,0.307485897681,0.302507381965,0.294965828841,0.303511425405,0.301044622193,0.299549784355,0.274376522706,0.272225688435,0.253867411733,0.261785882123,0.262775490434,0.25644488427,0.253968457639,0.261216496466,0.2599045036,0.263816423649,0.265774789528,0.276079867967,0.244866306644,0.260717682552,0.241530187865,0.256962945023,0.236230891498,0.25076546283,0.261747388445,0.261902967061,0.243252779965,0.252455976865,0.251137568386,0.263487623481,0.260292648189,0.263734624582,0.263469980545,0.266575137254,0.257944533817,0.284075325713,0.300311638403,0.309317555202,0.318376400809,0.319486301864,0.328015859395,0.332606230523,0.356060107879,0.381449896468,0.405147567119,0.425005493369,0.445519416051,0.437333093817,0.456441997244,0.47868492764,0.502703378943,0.51435092441,0.511709295742,0.540861841377,0.564246750893,0.585116740099,0.591822659624,0.632659640501,0.649707528241,0.65202035674,0.695919188938,0.737405750635,0.752978047376,0.778600401938,0.824733471376,0.848190556538,0.873692618356,0.906109107123,0.928379303874,0.981115643029,0.995161023868,1.0,0.961748511177,0.825960457369,0.271726874522)
GM24143_ONT_0.6 <- c(0.0,0.281728278173,0.387894977787,0.399745611936,0.416189797426,0.457994756172,0.471671365996,0.480655582491,0.474636625639,0.49281574813,0.507374132531,0.497357277371,0.493203312767,0.498665633161,0.478972667589,0.480702402381,0.480637374757,0.463761405845,0.446089498819,0.45300583688,0.430443852549,0.467343127361,0.463912269932,0.449798674477,0.461027644543,0.420757337717,0.418764891326,0.408269432855,0.426505779655,0.428565854775,0.426953169706,0.387837753478,0.393253253982,0.378658454111,0.39054030152,0.406381030662,0.390966882732,0.396314754508,0.3972043324,0.397797384329,0.416426497976,0.424261026084,0.441592188362,0.404791755538,0.418148429453,0.399852257239,0.422578111182,0.403218087043,0.424838471383,0.442351711007,0.440437297764,0.412033231717,0.420499828327,0.409809286985,0.424627781882,0.413843600762,0.40904976434,0.407868862693,0.411596246085,0.391073528035,0.415006294674,0.434990584,0.436816559675,0.451112232476,0.453445423616,0.470740170424,0.478772382508,0.500629467398,0.51540374351,0.545693610646,0.544112138837,0.568318021496,0.558363592854,0.579042377202,0.6043199151,0.6240805094,0.625989720433,0.610263439909,0.634583771186,0.647943046206,0.660558405211,0.648203156701,0.694437797176,0.715358484284,0.733079812304,0.771893500359,0.825078293259,0.837456951713,0.851006107394,0.887572440773,0.909413919033,0.924068544318,0.947827036925,0.95069345458,0.990165222186,1.0,0.982551788,0.912197101329,0.751017032035,0.149706595362)
MCF7_ONT_0.6 <- c(0.0,0.260258717041,0.353558935882,0.37121507917,0.403101867319,0.443311556663,0.457983638649,0.472734884133,0.468953820846,0.491680453191,0.508001551068,0.503964212732,0.498700511074,0.504162792351,0.474350356169,0.480311770002,0.475610263346,0.47603828293,0.461814346841,0.472133778259,0.457565011345,0.492877297922,0.486927959876,0.48780815062,0.501844241124,0.475329836722,0.474731414357,0.476422024627,0.489961666083,0.490311863925,0.487894022888,0.464480412402,0.465775205188,0.451402334384,0.453314334094,0.468549952837,0.456035411576,0.457483164339,0.454426648311,0.45459302583,0.463694144451,0.469968187008,0.485113908221,0.457968879353,0.473702288898,0.454739277036,0.482968443283,0.455534937266,0.475285558834,0.489086842356,0.484037821367,0.459138889001,0.46248119867,0.455701314785,0.46915374222,0.473954538685,0.467374576173,0.46851238372,0.473951855176,0.451426485959,0.474671035418,0.490334673746,0.493966802318,0.506175423625,0.511994611515,0.525913969405,0.527239622538,0.554305487909,0.571991149789,0.596950461094,0.603244629964,0.621186566894,0.610213701189,0.633180507532,0.648323545237,0.669351516786,0.669635968673,0.657400512282,0.674036922392,0.686572931719,0.700250773857,0.690023923477,0.72946344592,0.744509877323,0.753138698472,0.787314519256,0.827623498409,0.837056030313,0.847513662412,0.886399040377,0.90337625605,0.917003111528,0.936795327475,0.948323679412,0.990796908062,1.0,0.986751519201,0.927980002496,0.769952220134,0.201716640301)
MCF7_PanH <- c(0.0266503433207,0.497003108964,0.666363812134,0.729761360895,0.79731332098,0.867274428982,0.899981862949,0.937286868262,0.941372837884,0.974157268765,0.989393247199,1.0,0.979736123017,0.991728820287,0.961777875878,0.96340678839,0.962224457984,0.960658854046,0.947731072019,0.965018590477,0.94236096496,0.969433935791,0.965753483255,0.978161108345,0.986090079546,0.958116244809,0.951895749599,0.983510682894,0.98484700713,0.97228538821,0.954752335145,0.940862091681,0.936018985728,0.917787827301,0.900111046662,0.92983955554,0.91782718128,0.92357885083,0.913446912338,0.903352616783,0.908228232544,0.912763350837,0.927990774059,0.893742546271,0.91388322819,0.892304415003,0.924343686852,0.886689628858,0.906157015531,0.919314932782,0.91324073171,0.876032400302,0.874176774651,0.856391342809,0.85967312243,0.868055519909,0.855753123936,0.850815910643,0.845177169901,0.801279517623,0.806913125236,0.806047337703,0.805584500692,0.804426124882,0.795856368244,0.816694300004,0.807403338928,0.828218171614,0.835731359475,0.852665547645,0.856315201415,0.872157744435,0.849514662779,0.873743880884,0.873775535171,0.891140050544,0.881384541415,0.85228740724,0.861929132039,0.867221386663,0.876961496409,0.854650357009,0.863244923764,0.865815765204,0.866538680684,0.877893159081,0.883627718205,0.877635647176,0.880806209031,0.891719238449,0.891343664608,0.882853471449,0.886198559644,0.879432241859,0.904791603572,0.891300033023,0.859617513547,0.786753621849,0.617116585307,0.0)
data_matrix <- matrix(c(HeLa_ONT_0.6,GM24143_ONT_0.6,MCF7_ONT_0.6,MCF7_PanH), byrow=T, ncol=100)
rowLabel <- c("HeLa_ONT_0.6","GM24143_ONT_0.6","MCF7_ONT_0.6","MCF7_PanH")

pdf("AMPure_test_geneBody_coverage.geneBodyCoverage.curves.pdf")
png("AMPure_test_geneBody_coverage.geneBodyCoverage.curves.png")
x=1:100
icolor = colorRampPalette(c("#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f"))(4)
plot(x,HeLa_ONT_0.6,type='l',xlab="Gene body percentile (5'->3')", ylab="Coverage",lwd=0.8,col=icolor[1])
lines(x,GM24143_ONT_0.6,type='l',col=icolor[2])
lines(x,MCF7_ONT_0.6,type='l',col=icolor[3])
lines(x,MCF7_PanH,type='l',col=icolor[4])
legend(60,0.25,fill=icolor[1:4], legend=c('HeLa_ONT_0.6','GM24143_ONT_0.6','MCF7_ONT_0.6','MCF7_PanH'))
dev.off()


HeLa_ONT <- c(0.0,0.226249446735,0.299499220765,0.31953039016,0.346594175495,0.375548813681,0.381240026387,0.381519838692,0.378251970133,0.378023032792,0.38518792364,0.375530159527,0.37315429868,0.369630359466,0.357813801021,0.349475394323,0.339887159329,0.33243058535,0.310644229677,0.316593208871,0.302755218499,0.329245812566,0.321234701474,0.307328877817,0.312380761802,0.293811399723,0.29156442212,0.285986830167,0.293039796093,0.290104310636,0.291571205448,0.267068126665,0.265123007185,0.248127377345,0.255719617895,0.258878953197,0.251268058493,0.250058930167,0.257832624758,0.254162843978,0.25773935399,0.261217505736,0.27060054504,0.243472318084,0.258904390679,0.241617077708,0.255136251634,0.238198280087,0.25172254151,0.262075596806,0.262775975485,0.24582443728,0.254091619028,0.253616786025,0.264816061565,0.263939316342,0.267275018188,0.270307166078,0.272630456128,0.266571247844,0.288730686592,0.302712822696,0.31238754513,0.324275328525,0.325762573324,0.333037693261,0.339712488617,0.362046598076,0.386476756077,0.409884327289,0.429588201078,0.447609809372,0.440553451782,0.457950993842,0.480390244895,0.503187316532,0.515666945348,0.513285997005,0.539841032694,0.563280824717,0.584505859948,0.592881574953,0.632816726332,0.649412139784,0.653967144948,0.696586798625,0.738545077762,0.752342368162,0.777396592395,0.820923516274,0.846435615189,0.872654876111,0.903807312767,0.926417842868,0.977051999301,0.992677396762,1.0,0.965264270004,0.838424504096,0.31085960036)
GM24143_ONT <- c(0.0,0.279444528974,0.383327718124,0.395347889406,0.411712602704,0.450416793462,0.461738686258,0.472030822067,0.467610203017,0.484472134069,0.497831804547,0.489001434595,0.485610572534,0.491278311525,0.475492327088,0.476225927053,0.474071316785,0.455527539886,0.439353019171,0.445727187758,0.425593944268,0.460336695214,0.459133047863,0.443545407121,0.455397122115,0.415771855845,0.414581793679,0.40795494066,0.422425879233,0.42227915924,0.422148741469,0.38651208538,0.390516997783,0.377230687302,0.387533691258,0.403575077164,0.386593596487,0.391508716254,0.392024953267,0.391155501456,0.408998282833,0.416154958049,0.433505955745,0.398814828501,0.41212015824,0.394785462766,0.415573512151,0.396002695301,0.417249923923,0.433275007608,0.433832000174,0.406262226666,0.413712341868,0.403292505325,0.416603269139,0.40856083989,0.403588662348,0.403512585315,0.407965808808,0.390188236317,0.413122744859,0.433261422423,0.4357773986,0.452769747424,0.452916467417,0.468865474069,0.478201212885,0.499081641525,0.515253445203,0.542804199452,0.540717515107,0.564070447333,0.552702364909,0.571756944746,0.598821349389,0.619090444725,0.620813046124,0.605410163892,0.629002195366,0.641620114768,0.65675944442,0.64843716037,0.690863691692,0.712100052167,0.728529974351,0.768584532452,0.823762117985,0.836907142547,0.848959918272,0.885248663218,0.90731371995,0.92208624962,0.94540929444,0.951221036387,0.990224101204,1.0,0.983494000783,0.913720492979,0.755067273834,0.168010694257)
MCF7_ONT <- c(0.0,0.257599582139,0.347035795705,0.365200252458,0.398112278487,0.436895039528,0.451699738293,0.467730000598,0.46361259678,0.485211623947,0.50141871562,0.497426452585,0.492313363403,0.498554079862,0.470819073632,0.476430005495,0.471121043783,0.470575593195,0.4571134374,0.466605093774,0.45310621188,0.486637140696,0.482435402872,0.483865000299,0.496369557056,0.469257534291,0.468673997377,0.470559270484,0.484103039833,0.483018939786,0.482348348414,0.458868128819,0.46028004331,0.447778207005,0.450751660836,0.464319914251,0.450286463576,0.453285761699,0.450467373621,0.450957054948,0.458756590295,0.465370008651,0.479709510155,0.454809214714,0.470167525423,0.453255836729,0.480068609795,0.453563247784,0.472690744479,0.485438781673,0.479364012775,0.454515405919,0.458964704858,0.453210949274,0.466173902162,0.470729298722,0.465285674645,0.466965553639,0.472641776346,0.452101004935,0.47371363436,0.488741410173,0.49280304473,0.504400330807,0.509302584973,0.522791945286,0.525059441872,0.5506153662,0.568585310648,0.593565859418,0.599131903827,0.616383648996,0.606598183826,0.628153683764,0.642642810118,0.664176546441,0.665736725555,0.653389955004,0.668887008754,0.683401979401,0.696824688644,0.688058032678,0.725092903429,0.74161012661,0.75000680113,0.785119672675,0.826318194926,0.835822093333,0.845923130914,0.884507298972,0.902572459234,0.916071341128,0.936621634121,0.948020327216,0.990591317406,1.0,0.988095302868,0.929423318625,0.775853813801,0.214915693198)
HeLa_ONT_0.6 <- c(0.0,0.239847693347,0.317701157537,0.336781190706,0.36458004199,0.393472755297,0.400477000829,0.401139412875,0.398496180304,0.398165776233,0.405162002249,0.394810410615,0.390224851198,0.385605609812,0.370706952439,0.360536601874,0.352339052318,0.348653282629,0.323897035826,0.33215713761,0.316732399969,0.346046939833,0.33698488642,0.321906591882,0.325253937983,0.307485897681,0.302507381965,0.294965828841,0.303511425405,0.301044622193,0.299549784355,0.274376522706,0.272225688435,0.253867411733,0.261785882123,0.262775490434,0.25644488427,0.253968457639,0.261216496466,0.2599045036,0.263816423649,0.265774789528,0.276079867967,0.244866306644,0.260717682552,0.241530187865,0.256962945023,0.236230891498,0.25076546283,0.261747388445,0.261902967061,0.243252779965,0.252455976865,0.251137568386,0.263487623481,0.260292648189,0.263734624582,0.263469980545,0.266575137254,0.257944533817,0.284075325713,0.300311638403,0.309317555202,0.318376400809,0.319486301864,0.328015859395,0.332606230523,0.356060107879,0.381449896468,0.405147567119,0.425005493369,0.445519416051,0.437333093817,0.456441997244,0.47868492764,0.502703378943,0.51435092441,0.511709295742,0.540861841377,0.564246750893,0.585116740099,0.591822659624,0.632659640501,0.649707528241,0.65202035674,0.695919188938,0.737405750635,0.752978047376,0.778600401938,0.824733471376,0.848190556538,0.873692618356,0.906109107123,0.928379303874,0.981115643029,0.995161023868,1.0,0.961748511177,0.825960457369,0.271726874522)
GM24143_ONT_0.6 <- c(0.0,0.281728278173,0.387894977787,0.399745611936,0.416189797426,0.457994756172,0.471671365996,0.480655582491,0.474636625639,0.49281574813,0.507374132531,0.497357277371,0.493203312767,0.498665633161,0.478972667589,0.480702402381,0.480637374757,0.463761405845,0.446089498819,0.45300583688,0.430443852549,0.467343127361,0.463912269932,0.449798674477,0.461027644543,0.420757337717,0.418764891326,0.408269432855,0.426505779655,0.428565854775,0.426953169706,0.387837753478,0.393253253982,0.378658454111,0.39054030152,0.406381030662,0.390966882732,0.396314754508,0.3972043324,0.397797384329,0.416426497976,0.424261026084,0.441592188362,0.404791755538,0.418148429453,0.399852257239,0.422578111182,0.403218087043,0.424838471383,0.442351711007,0.440437297764,0.412033231717,0.420499828327,0.409809286985,0.424627781882,0.413843600762,0.40904976434,0.407868862693,0.411596246085,0.391073528035,0.415006294674,0.434990584,0.436816559675,0.451112232476,0.453445423616,0.470740170424,0.478772382508,0.500629467398,0.51540374351,0.545693610646,0.544112138837,0.568318021496,0.558363592854,0.579042377202,0.6043199151,0.6240805094,0.625989720433,0.610263439909,0.634583771186,0.647943046206,0.660558405211,0.648203156701,0.694437797176,0.715358484284,0.733079812304,0.771893500359,0.825078293259,0.837456951713,0.851006107394,0.887572440773,0.909413919033,0.924068544318,0.947827036925,0.95069345458,0.990165222186,1.0,0.982551788,0.912197101329,0.751017032035,0.149706595362)
MCF7_ONT_0.6 <- c(0.0,0.260258717041,0.353558935882,0.37121507917,0.403101867319,0.443311556663,0.457983638649,0.472734884133,0.468953820846,0.491680453191,0.508001551068,0.503964212732,0.498700511074,0.504162792351,0.474350356169,0.480311770002,0.475610263346,0.47603828293,0.461814346841,0.472133778259,0.457565011345,0.492877297922,0.486927959876,0.48780815062,0.501844241124,0.475329836722,0.474731414357,0.476422024627,0.489961666083,0.490311863925,0.487894022888,0.464480412402,0.465775205188,0.451402334384,0.453314334094,0.468549952837,0.456035411576,0.457483164339,0.454426648311,0.45459302583,0.463694144451,0.469968187008,0.485113908221,0.457968879353,0.473702288898,0.454739277036,0.482968443283,0.455534937266,0.475285558834,0.489086842356,0.484037821367,0.459138889001,0.46248119867,0.455701314785,0.46915374222,0.473954538685,0.467374576173,0.46851238372,0.473951855176,0.451426485959,0.474671035418,0.490334673746,0.493966802318,0.506175423625,0.511994611515,0.525913969405,0.527239622538,0.554305487909,0.571991149789,0.596950461094,0.603244629964,0.621186566894,0.610213701189,0.633180507532,0.648323545237,0.669351516786,0.669635968673,0.657400512282,0.674036922392,0.686572931719,0.700250773857,0.690023923477,0.72946344592,0.744509877323,0.753138698472,0.787314519256,0.827623498409,0.837056030313,0.847513662412,0.886399040377,0.90337625605,0.917003111528,0.936795327475,0.948323679412,0.990796908062,1.0,0.986751519201,0.927980002496,0.769952220134,0.201716640301)
png("1.curves.png")
x=1:100
icolor = colorRampPalette(c("#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f"))(6)
plot(x,HeLa_ONT_0.6,type='l',xlab="Gene body percentile (5'->3')", ylab="Coverage",lwd=0.8,col=icolor[1])
lines(x,GM24143_ONT_0.6,type='l',col=icolor[2])
lines(x,MCF7_ONT_0.6,type='l',col=icolor[3])
lines(x,MCF7_PanH,type='l',col=icolor[4])
legend(60,0.25,fill=icolor[1:6], legend=c("HeLa_ONT","GM24143_ONT","MCF7_ONT",'HeLa_ONT_0.6','GM24143_ONT_0.6','MCF7_ONT_0.6'))
dev.off()





#Aggregate results just as in pandas
total_reads = aggregate(summary_file$Primer.type, by = list(summary_file$Primer.type), FUN = length)
total_reads = data.frame(total_reads)
colnames(total_reads) <- c("Primer_type", "total_reads")

fail_pass <- aggregate(summary_file$Primer.type, by = list(summary_file$Quality, summary_file$Primer.type), FUN = length)
colnames(fail_pass) <- c('Quality','Primer_type','Total_reads')

barcoded <- aggregate(summary_file$Primer.type, by = list(summary_file$Primer.type, summary_file$Quality, summary_file$Barcode), FUN = length)
colnames(barcoded) <- c('Primer_type','Quality','Barcode','Total_reads')

head(barcoded)

#Plot total reads
ggplot(total_reads, aes(x=Primer_type, y=total_reads)) + #, fill=condition)) + 
  geom_bar(stat="identity") + #geom_bar(position="fill", stat="identity") +
  ggtitle("Total reads from the 2 experiments") +
  xlab("Primer type") +
  ylab("Total number of reads") +
  #ylim(c(0,1)) +
  #scale_fill_manual(values=c("#999999", "#E69F00", "#999999", "#E69F00", "#999999", "#E69F00", "#999999", "#E69F00")) + #999999=blue,#56B4E9=grey,#E69F00=yellow not sure though
  #scale_fill_manual(values=c("#56B4E9", "#999999", "#56B4E9", "#999999", "#56B4E9", "#999999", "#56B4E9", "#999999")) +
  my.theme

#Plot pass fail
ggplot(fail_pass, aes(x=Primer_type, y=Total_reads, fill=Quality)) + 
  geom_bar(position="fill", stat="identity") +
  ggtitle("Percentage of pass and fail reads from the 2 experiments") +
  xlab("Primer type") +
  ylab("%ge of total reads") +
  #ylim(c(0,1)) +
  my.theme

#Plot all-reads barcoded
barcoded$Barcode = factor(barcoded$Barcode , levels = c('unclassified','B01'), ordered = F)
ggplot(barcoded, aes(x=Primer_type, y=Total_reads, fill=Barcode)) + 
  geom_bar(position="fill", stat="identity") +
  ggtitle("Percentage of barcoded reads from the 2 experiments") +
  xlab("Primer type") +
  ylab("%ge of total reads") +
  #ylim(c(0,1)) +
  my.theme

#Plot pass-reads barcoded
barcoded_pass <- subset(barcoded, Quality == "PASS")
ggplot(barcoded_pass, aes(x=Primer_type, y=Total_reads, fill=Barcode)) + 
  geom_bar(position="fill", stat="identity") +
  ggtitle("Percentage of barcoded Pass reads from the 2 experiments") +
  xlab("Primer type") +
  ylab("%ge of total reads") +
  #ylim(c(0,1)) +
  my.theme
#Get percentage of unclassified reads
> 100*562563/(4308950+562563)
[1] 11.54801
> 100*170977/(170977+11123654)
[1] 1.51379

#Plot pass read lengths
p <- ggplot(summary_file, aes(x=Primer.type, y=read.length)) + #, color=fac)
  geom_violin(fill='#A4A4A4', color="darkred") +
  #geom_boxplot(width=0.1) + theme_minimal() +
  labs(x = "") +
  labs(y = "read length (bp)") + 
  ylim(0,1500) +
  theme(
    #plot.title = element_text(color="red", size=14, face="bold.italic"),
    #axis.text.x = element_text(size=14,angle=90,hjust=.5,vjust=.5,face="plain"),
    axis.text.x = element_text(size=14),
    axis.text.y = element_text(size=14),
    axis.title.x = element_text(size=14, face="bold"),
    axis.title.y = element_text(size=14, face="bold")
  )
p


GCF_000347755.3_Ccap_2.1_genomic_B002_05_5B.all.pychop.cutadapt_minimap2.sort <- c(0.0,0.102484705332,0.179333628237,0.241079849432,0.274799061871,0.301012828324,0.325152529358,0.345202523933,0.381431898041,0.425965880163,0.487605685527,0.515474113827,0.534568452505,0.553043075459,0.574587064843,0.584677789555,0.604992780416,0.617478904626,0.631949371103,0.632423025882,0.637505946767,0.644573209919,0.647619623914,0.644917496432,0.646574244865,0.646695266791,0.651784447431,0.654799562652,0.650363483094,0.654463622478,0.662916378022,0.652790181366,0.663813609542,0.671957550516,0.66924081694,0.673219934398,0.681528715582,0.686709705958,0.68521988432,0.699239648452,0.70452288149,0.708339245324,0.706968359026,0.704744059493,0.712070059176,0.717491006819,0.715053875623,0.722315191173,0.726782569504,0.728483136221,0.731487818517,0.730617712602,0.720842062214,0.72646332201,0.736526921119,0.738722008463,0.743892565915,0.740750169013,0.748003138224,0.744898299851,0.759068298098,0.769766219025,0.789442714897,0.793077545842,0.799216278701,0.801536561141,0.809021141278,0.813544857403,0.816651782361,0.836071628287,0.840413811523,0.846293807851,0.851053308072,0.845884837205,0.847779456319,0.855948436313,0.879839833741,0.896401058316,0.899699949087,0.912117215995,0.916263260247,0.929640356222,0.929275203859,0.93592723661,0.946418585629,0.946948578201,0.96107684475,0.968444576131,0.970823282949,0.976169113535,0.982983899911,0.983758022919,0.989064208391,0.993640089139,0.997385509085,1.0,0.979305250682,0.938237086126,0.831138941517,0.56406859022)
GCF_000347755.3_Ccap_2.1_genomic_B002_05_5A.all.porechop.pychop.cutadapt_minimap2.sort <- c(0.0,0.135674834857,0.256664971363,0.347867338046,0.42174885914,0.475774510766,0.528241672937,0.576865155963,0.639253313029,0.705328507171,0.775318761655,0.820160032677,0.847608085507,0.877168823469,0.909635370969,0.919408646444,0.94049584155,0.954775055048,0.969087976333,0.970651422816,0.971081692805,0.974764764259,0.984110743961,0.983419734323,0.986697320925,0.984626274824,0.994684083679,0.99560807361,0.990844370155,0.992876751442,1.0,0.995657643885,0.997297428592,0.99858823856,0.995788509412,0.988786212325,0.992499025944,0.990477550118,0.986645767839,0.996866167197,0.98988369822,0.990203922198,0.985365863331,0.979433292785,0.98248285612,0.981372481954,0.97942337873,0.979939900998,0.980756819135,0.97932622099,0.979426352946,0.975978244598,0.970526505722,0.967415475245,0.971141177135,0.967708931275,0.969133580986,0.957943587044,0.960509344493,0.952684180836,0.95283784869,0.952180546839,0.96045481719,0.951148493708,0.950432698933,0.944668667323,0.943773428151,0.939746338987,0.933884158232,0.936478666441,0.928643588729,0.925663423779,0.92057652213,0.913831990475,0.904919254979,0.901949004084,0.898322442744,0.892722984448,0.890510167359,0.885947719222,0.877246153099,0.873080267164,0.868207509104,0.866775919553,0.859791467766,0.849776289348,0.846966646145,0.840731696919,0.829649766177,0.82904699163,0.825321289739,0.814714242234,0.801958818998,0.796473372335,0.784364345489,0.768800270455,0.744385918473,0.699266062504,0.587412719138,0.338582825486)


pdf("B002_05_5AB_geneBody_coverage.geneBodyCoverage.curves.pdf")
png("B002_05_5AB_geneBody_coverage.geneBodyCoverage.curves.png")
x=1:100
icolor = colorRampPalette(c("#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f"))(2)
plot(x,GCF_000347755.3_Ccap_2.1_genomic_B002_05_5B.all.pychop.cutadapt_minimap2.sort,type='l',xlab="Gene body percentile (5'->3')", ylab="Coverage",lwd=0.8,col=icolor[1])
lines(x,GCF_000347755.3_Ccap_2.1_genomic_B002_05_5A.all.porechop.pychop.cutadapt_minimap2.sort,type='l',col=icolor[2])
legend(60,0.2,fill=icolor[1:2], legend=c('Regular primers','Panhandle primers'))
dev.off()

##Some summary stats
summary(summary_file$read.length[which(summary_file$Quality == 'PASS' & summary_file$Primer.type == 'Panhandle primer')])
summary(summary_file$read.length[which(summary_file$Quality == 'PASS' & summary_file$Primer.type == 'Regular primer')])
hist(summary_file$read.length[which(summary_file$Quality == 'PASS' & summary_file$Primer.type == 'Panhandle primer' & summary_file$read.length < 1500)],
     xlab="read length (bp)", col="darkmagenta", ylim=c(0,1300000), main="Histogram of Panhandle primers")
hist(summary_file$read.length[which(summary_file$Quality == 'PASS' & summary_file$Primer.type == 'Regular primer' & summary_file$read.length < 1500)],
     xlab="read length (bp)", col="blue", ylim=c(0,1300000), main="Histogram of Regular primers")


###Now, let us try to plot correlation of isoform expression
head(ont_panhandle)

#Get intersection of the 3 experiments
illumina_isoforms <- illumina_exp$transcript_id
panhandle_isoforms <- ont_panhandle$IsoformName
regular_isoforms <- ont_regular$IsoformName

intersect_all <- intersect(intersect(illumina_isoforms,panhandle_isoforms),regular_isoforms)
length(regular_isoforms)

illumina_exp2 <- subset(illumina_exp, (illumina_exp$transcript_id %in% intersect_all), select=c(transcript_id,TPM))
ont_panhandle2 <- subset(ont_panhandle, (ont_panhandle$IsoformName %in% intersect_all), select=c(IsoformName,RelativeAbundance))
ont_regular2 <- subset(ont_regular, (ont_regular$IsoformName %in% intersect_all), select=c(IsoformName,RelativeAbundance))

#order all of them
illumina_exp3 <- illumina_exp2[order(illumina_exp2$transcript_id),]
ont_panhandle3 <- ont_panhandle2[order(ont_panhandle2$IsoformName),]
ont_regular3 <- ont_regular2[order(ont_regular2$IsoformName),]

final_df <- expressions[which(expressions$MCF7_ONT < 250),]


head(final_df)
dim(ont_regular3)

final_df <- cbind.data.frame(illumina_exp3$transcript_id, illumina_exp3$TPM, ont_panhandle3$RelativeAbundance, ont_regular3$RelativeAbundance)
colnames(final_df) <- c('transcript_id','Illumina_TPM','Panhandle_RA','Regular_RA')

my.theme <- theme(axis.text = element_text(colour="black", size=15),
                  text = element_text(size=16),
                  title = element_text(size=19),
                  axis.title.x=  element_text(vjust=-0.45, face="bold"),
                  axis.title.y = element_text(vjust=.2, face="bold"),
                  axis.ticks = element_line(colour="black"),
                  axis.line = element_line())

lm_eqn = function(df1){
  m = lm(MCF7_PanH ~ ill_TPM, df1);
  eq <- substitute(italic(y) == a + b %.% italic(x)*","
                   
                   ~~italic(r)^2~"="~r2~~", p < "~~p, 
                   list(a = format(coef(m)[1], digits = 2),
                        b = format(coef(m)[2], digits = 2),              
                        r2 = format(summary(m)$r.squared, digits = 3),              
                        p = format(coef(summary(m))[8], digits = 3, scientific=T)             
                   ))
  as.character(as.expression(eq));                 
}
lm_eqn2 = function(df1){
  eq <- substitute(italic(r) == r2*", (Spearman's rho)", 
                   list(           
                     r2 = format(cor(final_df$MCF7_PanH,final_df$ill_TPM, method=c("spearman")), digits = 3)
                   ))
  as.character(as.expression(eq));                 
}

ggplot(data = final_df, aes(x = ill_TPM, y = MCF7_PanH)) +
  geom_point() +
  #geom_smooth(method = "lm") +
  ggtitle("correlation of Illumina TPM and Panhandle primer relative abundance") +
  scale_x_continuous("ONT") +
  scale_y_continuous("Illumina TPM") +
  geom_smooth(method = "loess") +
  annotate(geom = "text", x = 50, y = 500, label = lm_eqn(final_df), parse = T, color = "red") +
  annotate(geom = "text", x = 50, y = 300, label = lm_eqn2(final_df), parse = T, color = "red") +
  #ylim(0,2500) +
  my.theme

ggplot(data = final_df, aes(x = Regular_RA, y = Illumina_TPM)) +
  geom_point() +
  #geom_smooth(method = "lm") +
  ggtitle("correlation of Illumina TPM and Regular primer relative abundance") +
  scale_x_continuous("Regular RA") +
  scale_y_continuous("Illumina TPM") +
  geom_smooth(method = "loess") +
  annotate(geom = "text", x = 0.2, y = 900, label = lm_eqn(final_df), parse = T, color = "red") +
  annotate(geom = "text", x = 0.2, y = 800, label = lm_eqn2(final_df), parse = T, color = "red") +
  my.theme

ggplot(data = final_df, aes(x = Regular_RA, y = Panhandle_RA)) +
  geom_point() +
  #geom_smooth(method = "lm") +
  ggtitle("correlation of Panhandle and Regular primer relative abundance") +
  scale_x_continuous("Regular RA") +
  scale_y_continuous("Panhandle RA") +
  geom_smooth(method = "loess") +
  annotate(geom = "text", x = 0.2, y = 0.9, label = lm_eqn(final_df), parse = T, color = "red") +
  annotate(geom = "text", x = 0.2, y = 0.8, label = lm_eqn2(final_df), parse = T, color = "red") +
  my.theme
